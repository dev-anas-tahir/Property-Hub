<div>
    {% if images %}
        <div class="carousel-container position-relative" 
                tabindex="0"
                unicorn:keydown.arrow-left="previous_image"
                unicorn:keydown.arrow-right="next_image">
            
            <!-- Main Image Display -->
            <div class="carousel-main-image">
                {% for img in images %}
                    {% if forloop.counter0 == current_index %}
                        <img src="{{ img.url }}"
                                alt="Property image {{ forloop.counter }}"
                                class="img-fluid w-100 rounded">
                    {% endif %}
                {% endfor %}
            </div>

            <!-- Navigation Buttons -->
            {% if images|length > 1 %}
                <button class="carousel-btn carousel-btn-prev btn btn-dark position-absolute top-50 start-0 translate-middle-y ms-2"
                        unicorn:click="previous_image"
                        aria-label="Previous image">
                    <i class="bi bi-chevron-left"></i>
                </button>
                
                <button class="carousel-btn carousel-btn-next btn btn-dark position-absolute top-50 end-0 translate-middle-y me-2"
                        unicorn:click="next_image"
                        aria-label="Next image">
                    <i class="bi bi-chevron-right"></i>
                </button>
            {% endif %}

            <!-- Image Counter -->
            <div class="carousel-counter position-absolute bottom-0 end-0 bg-dark bg-opacity-75 text-white px-3 py-1 m-2 rounded">
                {{ current_index|add:1 }} / {{ images|length }}
            </div>
        </div>

        <!-- Thumbnail Indicators -->
        {% if images|length > 1 %}
            <div class="carousel-thumbnails d-flex gap-2 mt-3 overflow-auto">
                {% for image in images %}
                    <div class="carousel-thumbnail {% if forloop.counter0 == current_index %}active{% endif %}"
                            unicorn:click="go_to_image({{ forloop.counter0 }})"
                            role="button"
                            tabindex="0"
                            aria-label="Go to image {{ forloop.counter }}">
                        <img src="{{ image.url }}" 
                                alt="Thumbnail {{ forloop.counter }}"
                                class="img-thumbnail"
                                style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;">
                        {% if image.is_primary %}
                            <span class="badge bg-primary position-absolute top-0 start-0 m-1" style="font-size: 0.6rem;">Primary</span>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% else %}
        <!-- Empty State -->
        <div class="carousel-empty text-center py-5 bg-light rounded">
            <i class="bi bi-image text-muted" style="font-size: 4rem;"></i>
            <p class="text-muted mt-3">No images available for this property</p>
        </div>
    {% endif %}
</div>

<style>
    .carousel-container {
        outline: none;
    }

    .carousel-main-image {
        max-height: 500px;
        overflow: hidden;
        background-color: #f8f9fa;
    }

    .carousel-main-image img {
        object-fit: contain;
        max-height: 500px;
    }

    .carousel-btn {
        opacity: 0.7;
        transition: opacity 0.3s;
        z-index: 10;
    }

    .carousel-btn:hover {
        opacity: 1;
    }

    .carousel-thumbnail {
        position: relative;
        flex-shrink: 0;
        transition: transform 0.2s;
    }

    .carousel-thumbnail:hover {
        transform: scale(1.05);
    }

    .carousel-thumbnail.active img {
        border-color: #0d6efd;
        border-width: 3px;
    }

    .carousel-thumbnails {
        scrollbar-width: thin;
    }

    .carousel-thumbnails::-webkit-scrollbar {
        height: 8px;
    }

    .carousel-thumbnails::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .carousel-thumbnails::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .carousel-thumbnails::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
""
